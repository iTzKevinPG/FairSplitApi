generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Event {
  id            String    @id @default(uuid())
  name          String
  currency      String
  participants  Person[]
  invoices      Invoice[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Person {
  id              String          @id @default(uuid())
  name            String
  event           Event           @relation(fields: [eventId], references: [id], onDelete: Cascade)
  eventId         String
  invoicesPaid    Invoice[]       @relation("InvoicePayer")
  participations  Participation[]
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
}

model Invoice {
  id                String          @id @default(uuid())
  description       String
  amount            Decimal         @db.Decimal(10, 2)
  divisionMethod    String
  tipAmount         Decimal?        @db.Decimal(10, 2)
  birthdayPersonId  String?
  consumptions      Json?
  event             Event           @relation(fields: [eventId], references: [id], onDelete: Cascade)
  eventId           String
  payer             Person          @relation("InvoicePayer", fields: [payerId], references: [id])
  payerId           String
  participations    Participation[]
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
}

model Participation {
  id         String   @id @default(uuid())
  amount     Decimal  @db.Decimal(10, 2)
  person     Person   @relation(fields: [personId], references: [id], onDelete: Cascade)
  personId   String
  invoice    Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  invoiceId  String
}
